blueprint:
  name: Ring Intercom – Klingelbenachrichtigung (mit TTS & Push)
  description: >
    Gibt eine Benachrichtigung aus, wenn jemand an der Tür klingelt – über HomePods (TTS), Push und optional zeitlich eingeschränkt.
  domain: automation
  input:
    ring_sensor:
      name: Klingelsensor
      description: Entität, die ein Klingeln anzeigt (z. B. binary_sensor.ring_intercom_klingel)
      selector:
        entity:
          domain: binary_sensor
    media_players:
      name: Lautsprecher (z. B. HomePods)
      description: Wähle die media_player-Geräte aus, auf denen TTS abgespielt wird.
      selector:
        target:
          entity:
            domain: media_player
            multiple: true
    tts_service:
      name: TTS-Service
      description: Wähle den TTS-Service (z. B. tts.google_say)
      default: tts.google_say
      selector:
        text:
    tts_message:
      name: TTS-Nachricht
      description: Nachricht, die bei Klingeln gesprochen werden soll
      default: "Es hat jemand an der Tür geklingelt!"
      selector:
        text:
    notify_device:
      name: Mobilgerät für Push-Benachrichtigung
      description: Gerät, das eine Push-Nachricht erhalten soll (z. B. Handy mit HA App)
      selector:
        device:
          integration: mobile_app
    push_message:
      name: Push-Nachricht
      description: Nachricht, die als Push-Mitteilung gesendet wird
      default: "Klingel: Es hat jemand an der Tür geklingelt."
      selector:
        text:
    start_time:
      name: Startzeit (aktiv ab)
      description: Zeit, ab der Benachrichtigungen erfolgen dürfen
      default: "07:00:00"
      selector:
        time:
    end_time:
      name: Endzeit (aktiv bis)
      description: Zeit, bis zu der Benachrichtigungen erfolgen dürfen
      default: "22:00:00"
      selector:
        time:

trigger:
  - platform: state
    entity_id: !input ring_sensor
    from: "off"
    to: "on"

condition:
  - condition: time
    after: !input start_time
    before: !input end_time

action:
  - repeat:
      for_each: !input media_players
      sequence:
        - service: !input tts_service
          data:
            entity_id: "{{ repeat.item }}"
            message: !input tts_message
  - service: notify.mobile_app_{{ device_attr(!input notify_device, "name") | lower | replace(" ", "_") }}
    data:
      message: !input push_message

mode: single
